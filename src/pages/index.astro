---
let url: string | undefined;
let token: string | undefined;

if (Astro.request.method === "POST") {
	const form = await Astro.request.formData()
	const urlVal = form.get("url")
	const tokenVal = form.get("token")

	if (urlVal && tokenVal) {
		url = urlVal.toString()
		token = tokenVal.toString()
		Astro.cookies.set("fintrackApiUrl", url);
		Astro.cookies.set("fintrackApiToken", token);
	}
} else {
	url = Astro.cookies.get("fintrackApiUrl").value
	token = Astro.cookies.get("fintrackApiToken").value
}

if (url && token) {
	Astro.redirect("/transaction")
}
---
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>Astro</title>
	</head>
	<body>
		<header class="p-3 bg-teal-600 text-center text-white shadow-md">
			<h1 class="font-bold text-lg">FinTrack</h1>
		</header>
		<form class="max-w-xs mx-auto flex flex-col gap-5 mt-10" method="post">
			<input class="rounded-md shadow-md outline-none text-md p-4 w-full" name="url" placeholder="API Url" />
			<input class="rounded-md shadow-md outline-none text-md p-4 w-full" name="token" placeholder="API Token" />
			<button class="rounded-md shadow-md bg-teal-600 text-white text-md font-semibold p-4 w-full">Next</button>
		</form>
	</body>
</html>
